{% extends "base.html" %}
{% block main %}
<form action="/form/save" method="POST" class="row">
  <div class="col-xl-6 col-lg-12">
    <div class="form-group">
      <label for="exampleFormControlInput1">组件名称</label>
      <input type="text" class="form-control" id="name" name="type" value="{{type}}" placeholder="表单名称">
    </div>
    <div class="form-group">
      <label for="exampleFormControlTextarea1">表单json</label>
      <textarea class="form-control" id="content" name="content" rows="20">{{content}}</textarea>
    </div>
    <div class="form-group">
      <button type="button" id="resolve" class="btn btn-primary">解析</button>
      <button type="button" id="save" class="btn btn-primary">保存</button>
      <button type="button" id="preview" class="btn btn-primary">预览</button>
    </div>
  </div>
  <div class="col-xl-6 col-lg-12">
    <div class="form-group" id="list">
      <textarea class="form-control" id="form_content" name="content" rows="10"></textarea>
    </div>
    <div class="form-group">
      <iframe src="" frameborder="0" id="frame" style="width: 100%;height: 400px;"></iframe>
    </div>
  </div>
  <br>
</form>
{% endblock %}
{% block script %}
<script>
  $('#list').hide()
  document.getElementById('save').addEventListener('click', () => {
    const content = document.getElementById('content').value
    console.log(content, eval('(' + content + ')'))
    $.ajax({url: '/form/save', type: 'post', data: {
      content: eval('(' + content + ')'),
      name: document.getElementById('name').value
    }, success: function  (data) {
      console.log(data.data)
    }})
  })
  document.getElementById('resolve').addEventListener('click', () => {
    const content = document.getElementById('content').value
    $.ajax({url: '/form/resolve', type: 'post', data: {
      content: eval('(' + content + ')'),
      name: document.getElementById('name').value
    }, success: function  (data) {
      $('#list').show()
      console.log(data)
      $('#form_content').val(data.data)
    }})
  })
  document.getElementById('preview').addEventListener('click', () => {
    const content = document.getElementById('content').value
    $.ajax({url: '/form/preview', type: 'post', data: {
      content: eval('(' + content + ')'),
      name: document.getElementById('name').value
    }, success: function  (data) {
      document.getElementById('frame').srcdoc = data
    }})
  })
</script>
{% endblock %}